{{- $fullName := include "growthbook.fullname" . -}}
{{- $generated_jwt_secret := (randAlphaNum 32 | b64enc) }}
kind: Secret
apiVersion: v1
metadata:
  name: {{ $fullName }}
  labels:
    {{- include "growthbook.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": "pre-install"
    "helm.sh/hook-delete-policy": "before-hook-creation"
    "helm.sh/hook-weight": "0"
type: Opaque
data:
  MONGODB_URI: {{ .Values.growthbookSettings.mongodbUri | b64enc | quote }}
  JWT_SECRET: {{ .Values.growthbookSettings.jwtSecret | default $generated_jwt_secret | b64enc | quote }}
  {{- if .Values.growthbookSettings.encryptionKey }}
  ENCRYPTION_KEY: {{ .Values.growthbookSettings.encryptionKey | b64enc | quote }}
  {{- end }}
